{% extends 'layouts/base.html' %} {% block title %} Plot Result {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %} {% block content %}

<div class="container-fluid mt--7 pb-8 pt-5 pt-md-8">
  <div class="row">
    <div class="col">
      <div class="card shadow">
        <div class="card-header bg-transparent">
          <h3 class="mb-0">Plot Result</h3>
        </div>
        <div class="card-body">
          <form id="fileUploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" name="file" id="fileInput" class="form-control" />
            <button type="submit" class="btn btn-primary mt-2">Upload and Plot</button>
          </form>
          <div id="plotContainer" class="mt-4">
            <!-- This is where the plot will be displayed -->
          </div>
        </div>
      </div>
    </div>
  </div>

  {% include "includes/footer.html" %}
</div>

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
<script src="/static/assets/vendor/clipboard/dist/clipboard.min.js"></script>
<script>
  // Function to handle file upload and plot
  function handleFileUpload() {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];

    // Create a FormData object to send the file to the server
    const formData = new FormData();
    formData.append("file", file);

    // Use Fetch API to send the file to the server for processing
    fetch("{% url 'plot' %}", {
      method: "POST",
      body: formData,
      headers: {
        "X-CSRFToken": "{% csrf_token %}",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        // Process the data received from the server and display the plot
        // Assuming data contains the necessary information for plotting the result
        // For example, if data is a URL to the generated plot image, you can do:
        const plotContainer = document.getElementById("plotContainer");
        plotContainer.innerHTML = `<img src="${data.plot_url}" alt="Plot">`;
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  }

  // Attach an event listener to the form submit event
  const fileUploadForm = document.getElementById("fileUploadForm");
  fileUploadForm.addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent default form submission
    handleFileUpload();
  });
</script>

{% endblock javascripts %}
